plugins {
    id 'java'
    id 'com.vanniktech.maven.publish' version '0.30.0' apply false
}

allprojects {
    group = 'io.github.inference4j'
    version = '0.1.0-SNAPSHOT'

    repositories {
        mavenCentral()
    }
}

subprojects {
    apply plugin: 'java-library'

    java {
        sourceCompatibility = JavaVersion.VERSION_21
        targetCompatibility = JavaVersion.VERSION_21
        toolchain {
            languageVersion = JavaLanguageVersion.of(21)
        }
    }

    tasks.withType(JavaCompile).configureEach {
        options.encoding = 'UTF-8'
    }

    tasks.withType(Test).configureEach {
        useJUnitPlatform()
        jvmArgs '--enable-native-access=ALL-UNNAMED'
    }

    tasks.withType(JavaExec).configureEach {
        jvmArgs '--enable-native-access=ALL-UNNAMED'
    }

    dependencies {
        implementation 'org.slf4j:slf4j-api:2.0.16'

        testImplementation platform('org.junit:junit-bom:6.0.2')
        testImplementation 'org.junit.jupiter:junit-jupiter'
        testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
        testRuntimeOnly 'org.slf4j:slf4j-simple:2.0.16'
    }
}

// Publishing configuration for library modules only
def publishedModules = [
    'inference4j-core',
    'inference4j-preprocessing',
    'inference4j-models',
    'inference4j-runtime',
]

configure(subprojects.findAll { it.name in publishedModules }) {
    apply plugin: 'com.vanniktech.maven.publish'

    mavenPublishing {
        publishToMavenCentral(com.vanniktech.maven.publish.SonatypeHost.CENTRAL_PORTAL)
        signAllPublications()

        coordinates(project.group.toString(), project.name, project.version.toString())

        pom {
            name = project.name
            description = project.description
            url = 'https://github.com/inference4j/inference4j'
            inceptionYear = '2025'

            licenses {
                license {
                    name = 'The Apache License, Version 2.0'
                    url = 'https://www.apache.org/licenses/LICENSE-2.0.txt'
                    distribution = 'repo'
                }
            }

            developers {
                developer {
                    id = 'viniciusccarvalho'
                    name = 'Vinicius Carvalho'
                    url = 'https://github.com/viniciusccarvalho'
                }
                developer {
                    id = 'ArthurCRodrigues'
                    name = 'Arthur Rodrigues'
                    url = 'https://github.com/ArthurCRodrigues'
                }
            }

            scm {
                connection = 'scm:git:git://github.com/inference4j/inference4j.git'
                developerConnection = 'scm:git:ssh://github.com:inference4j/inference4j.git'
                url = 'https://github.com/inference4j/inference4j'
            }
        }
    }
}
